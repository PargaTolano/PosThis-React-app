{"ast":null,"code":"import _regeneratorRuntime from\"D:/Repositories/Visual C++/PosThis-React-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"D:/Repositories/Visual C++/PosThis-React-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"D:/Repositories/Visual C++/PosThis-React-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"D:/Repositories/Visual C++/PosThis-React-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"D:/Repositories/Visual C++/PosThis-React-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useRef}from'react';import{Link}from'react-router-dom';import{makeStyles}from'@material-ui/core/styles';import{Card,CardActions,CardContent,Typography,IconButton,Button,Avatar}from'@material-ui/core';import{Favorite as FavoriteIcon,QuestionAnswer as QuestionAnswerIcon,ReplyAll as ReplyAllIcon,Save as SaveIcon,Image as ImageIcon}from'@material-ui/icons';import{MediaGrid}from'components/Media';import{authenticationService}from'_services';import{handleResponse,history}from'_helpers';import{fileToBase64,routes}from'_utils';import{updateReply,deleteReply}from'_api';import{UReplyModel}from'_model';import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{root:{width:'100%',maxWidth:'600px',marginTop:theme.spacing(0),borderBottomStyle:'solid',borderBottomColor:'white',borderBottomWidth:theme.spacing(0.3),backgroundColor:'#1b2452',borderRadius:theme.spacing(0),boxShadow:'black 1px 1px 8px'},rootFirst:{width:'100%',maxWidth:'600px',marginTop:theme.spacing(0),borderBottomStyle:'solid',borderBottomColor:'white',borderBottomWidth:theme.spacing(0.3),backgroundColor:'#1b2452',borderRadius:theme.spacing(1,1,0,0),boxShadow:'black 1px 1px 8px'},rootLast:{width:'100%',maxWidth:'600px',marginTop:theme.spacing(0),borderBottomStyle:'solid',borderBottomColor:'white',borderBottomWidth:theme.spacing(0),backgroundColor:'#1b2452',borderRadius:theme.spacing(0,0,1,1),boxShadow:'black 1px 1px 8px'},rootOnly:{width:'100%',maxWidth:'600px',marginTop:theme.spacing(0),borderBottomStyle:'solid',borderBottomColor:'white',borderBottomWidth:theme.spacing(0),backgroundColor:'#1b2452',borderRadius:theme.spacing(2),boxShadow:'black 1px 1px 8px'},media:{height:140},title:{color:'white',marginLeft:theme.spacing(2)},content:{color:'white',marginLeft:theme.spacing(7),marginBottom:theme.spacing(1)},contentNoMedia:{color:'white',marginLeft:theme.spacing(7),marginBottom:theme.spacing(1),fontSize:'1.3rem',textIndent:'0',whiteSpace:'pre-wrap'},contentEdit:{color:'white',marginBottom:theme.spacing(1),background:'transparent',outline:'none',width:'100%',height:'70px',resize:'none',textDecoration:'underline',boxSizing:'border-box',whiteSpace:'pre-wrap'},input:{display:'none'},displayTitle:{display:'inline-flex'},displaybtn:{textAlign:'right',marginTop:theme.spacing(2)},imgPost:{maxWidth:450},contImg:{alignItems:'center',textAlign:'center',marginBottom:theme.spacing(1)},contMedia:{display:'flex',flexDirection:'column',flexWrap:'wrap'},date:{fontSize:'0.7rem',color:'gray',display:'block'},avatar:{backgroundColor:'#333333',border:'1px solid #f28a9a'},cardBtn:{alignItems:'center',justifyContent:'space-around',color:'white'},saveIcon:{color:'#33eaff'},mediaIcon:{color:'#ea5970'},deleteBtn:{marginRight:theme.spacing(2)}};});export var ReplyCard=function ReplyCard(props){var reply=props.reply,first=props.first,last=props.last;var classes=useStyles();var inputFileRef=useRef();var _useState=useState({editMode:false,content:reply.content,originalContent:reply.content,medias:reply.medias,originalMedias:reply.medias,deleted:[],newMedias:[]}),_useState2=_slicedToArray(_useState,2),state=_useState2[0],setState=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),del=_useState4[0],setDel=_useState4[1];var temp={state:state,setState:setState};var cardRootClass;if(first&&last){cardRootClass=classes.rootOnly;}else if(first){cardRootClass=classes.rootFirst;}else if(last){cardRootClass=classes.rootLast;}else{cardRootClass=classes.root;}var dateString=new Date(Date.parse(reply.date)).toLocaleString();var onClickSave=function onClickSave(){var model=new UReplyModel({content:state.content,deleted:state.deleted,files:state.newMedias});updateReply(reply.replyID,model).then(handleResponse).then(function(res){var data=res.data;setState(function(x){var copy=_objectSpread({},x);copy.editMode=false;copy.originalContent=data.content;copy.medias=data.medias;copy.originalMedias=data.medias;return copy;});}).catch(console.warn);};var onChangeContent=function onChangeContent(e){setState(function(x){var copy=_objectSpread({},x);copy.content=e.target.value;return copy;});};var onChangeImages=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var files,mediaInfo,newMediaFiles,i,file,preview,mediaViewModel;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:files=e.target.files;if(!(state.medias.length+files.length>4)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:mediaInfo=[];newMediaFiles=[];i=0;case 6:if(!(i<files.length)){_context.next=17;break;}file=files[i];_context.next=10;return fileToBase64(file);case 10:preview=_context.sent;mediaViewModel={mediaID:null,mime:file.type,path:preview,isVideo:file.type.includes('video')};mediaInfo.push(mediaViewModel);newMediaFiles.push(file);case 14:i++;_context.next=6;break;case 17:setState(function(x){var copy=_objectSpread({},x);copy.medias=[].concat(_toConsumableArray(copy.medias),mediaInfo);copy.newMedias=[].concat(_toConsumableArray(copy.newMedias),newMediaFiles);return copy;});case 18:case\"end\":return _context.stop();}}},_callee);}));return function onChangeImages(_x){return _ref.apply(this,arguments);};}();var onClickFileOpen=function onClickFileOpen(){var _inputFileRef$current;return(_inputFileRef$current=inputFileRef.current)===null||_inputFileRef$current===void 0?void 0:_inputFileRef$current.click();};var onToggleEditMode=function onToggleEditMode(){setState(function(x){var copy=_objectSpread({},x);copy.editMode=!copy.editMode;if(copy.editMode===false){copy.medias=_toConsumableArray(copy.originalMedias);copy.content=copy.originalContent;copy.deleted=[];copy.newMedias=[];}return copy;});};var onClickDelete=function onClickDelete(){if(window.confirm('Seguro que quiere borrar la respuesta')){deleteReply(reply.replyID).then(handleResponse).then(function(res){setDel(true);}).catch(console.warn);}};if(del){return/*#__PURE__*/_jsx(_Fragment,{});}return/*#__PURE__*/_jsxs(Card,{className:cardRootClass,children:[/*#__PURE__*/_jsxs(CardContent,{children:[/*#__PURE__*/_jsxs(\"div\",{className:classes.displayTitle,children:[/*#__PURE__*/_jsx(Link,{to:routes.getProfile(reply.publisherID),children:/*#__PURE__*/_jsx(Avatar,{className:classes.avatar,src:reply.publisherProfilePic})}),/*#__PURE__*/_jsx(Link,{to:routes.getProfile(reply.publisherID),children:/*#__PURE__*/_jsx(Typography,{variant:\"h6\",component:\"h2\",className:classes.title,children:/*#__PURE__*/_jsxs(\"strong\",{children:[reply.publisherUserName,\" \",'@'+reply.publisherTag]})})})]}),/*#__PURE__*/_jsxs(\"p\",{className:classes.date,children:[dateString.slice(0,dateString.length-6),\" \",dateString.slice(dateString.length-3)]}),state.editMode?/*#__PURE__*/_jsx(\"textarea\",{className:classes.contentEdit,value:state.content,onChange:onChangeContent}):/*#__PURE__*/_jsx(Typography,{variant:\"body2\",component:\"p\",className:state.medias.length!==0?classes.content:classes.contentNoMedia,children:state.originalContent}),state.editMode&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"input\",{accept:\"image/*\",className:classes.input,type:\"file\",multiple:true,ref:inputFileRef,onChange:onChangeImages}),/*#__PURE__*/_jsx(IconButton,{onClick:onClickFileOpen,children:/*#__PURE__*/_jsx(ImageIcon,{className:classes.mediaIcon})})]}),/*#__PURE__*/_jsx(\"div\",{className:classes.contMedia,children:/*#__PURE__*/_jsx(MediaGrid,_objectSpread({media:state.medias},temp))}),/*#__PURE__*/_jsx(\"div\",{className:classes.displaybtn,children:authenticationService.currentUserValue.id===reply.publisherID&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",onClick:onClickDelete,className:classes.deleteBtn,children:\"Eliminar\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"secondary\",onClick:onToggleEditMode,children:state.editMode?'Cancelar':'Editar'})]})})]}),/*#__PURE__*/_jsx(CardActions,{disableSpacing:true,className:classes.cardBtn,children:authenticationService.currentUserValue.id===reply.publisherID&&state.editMode&&/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(IconButton,{onClick:onClickSave,children:/*#__PURE__*/_jsx(SaveIcon,{className:classes.saveIcon})})})})]});};export default ReplyCard;","map":{"version":3,"sources":["D:/Repositories/Visual C++/PosThis-React-app/src/components/Post/ReplyCard.js"],"names":["React","useState","useRef","Link","makeStyles","Card","CardActions","CardContent","Typography","IconButton","Button","Avatar","Favorite","FavoriteIcon","QuestionAnswer","QuestionAnswerIcon","ReplyAll","ReplyAllIcon","Save","SaveIcon","Image","ImageIcon","MediaGrid","authenticationService","handleResponse","history","fileToBase64","routes","updateReply","deleteReply","UReplyModel","useStyles","theme","root","width","maxWidth","marginTop","spacing","borderBottomStyle","borderBottomColor","borderBottomWidth","backgroundColor","borderRadius","boxShadow","rootFirst","rootLast","rootOnly","media","height","title","color","marginLeft","content","marginBottom","contentNoMedia","fontSize","textIndent","whiteSpace","contentEdit","background","outline","resize","textDecoration","boxSizing","input","display","displayTitle","displaybtn","textAlign","imgPost","contImg","alignItems","contMedia","flexDirection","flexWrap","date","avatar","border","cardBtn","justifyContent","saveIcon","mediaIcon","deleteBtn","marginRight","ReplyCard","props","reply","first","last","classes","inputFileRef","editMode","originalContent","medias","originalMedias","deleted","newMedias","state","setState","del","setDel","temp","cardRootClass","dateString","Date","parse","toLocaleString","onClickSave","model","files","replyID","then","res","data","x","copy","catch","console","warn","onChangeContent","e","target","value","onChangeImages","length","mediaInfo","newMediaFiles","i","file","preview","mediaViewModel","mediaID","mime","type","path","isVideo","includes","push","onClickFileOpen","current","click","onToggleEditMode","onClickDelete","window","confirm","getProfile","publisherID","publisherProfilePic","publisherUserName","publisherTag","slice","currentUserValue","id"],"mappings":"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","sourcesContent":["import React, { useState, useRef}  from 'react';\r\nimport { Link }                    from 'react-router-dom';\r\n\r\nimport { makeStyles }     from '@material-ui/core/styles';\r\n\r\nimport {\r\n  Card,\r\n  CardActions,\r\n  CardContent,\r\n  Typography,\r\n  IconButton,\r\n  Button,\r\n  Avatar,\r\n} from '@material-ui/core';\r\n\r\nimport {\r\n  Favorite as FavoriteIcon,\r\n  QuestionAnswer as QuestionAnswerIcon,\r\n  ReplyAll       as ReplyAllIcon,\r\n  Save           as SaveIcon,\r\n  Image          as ImageIcon,\r\n\r\n} from '@material-ui/icons';\r\n\r\nimport { MediaGrid }                from 'components/Media';\r\n\r\nimport { authenticationService }    from '_services';\r\nimport { handleResponse, history }  from '_helpers';\r\nimport { fileToBase64, routes }     from '_utils';\r\nimport { updateReply, deleteReply } from '_api';\r\nimport { UReplyModel }              from '_model';\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    width: '100%',\r\n    maxWidth: '600px',\r\n    marginTop: theme.spacing(0),\r\n    borderBottomStyle: 'solid',\r\n    borderBottomColor: 'white',\r\n    borderBottomWidth: theme.spacing(0.3),\r\n    backgroundColor: '#1b2452',\r\n    borderRadius: theme.spacing( 0 ),\r\n    boxShadow:        'black 1px 1px 8px',\r\n  },\r\n  rootFirst:{\r\n    width: '100%',\r\n    maxWidth: '600px',\r\n    marginTop: theme.spacing(0),\r\n    borderBottomStyle: 'solid',\r\n    borderBottomColor: 'white',\r\n    borderBottomWidth: theme.spacing(0.3),\r\n    backgroundColor: '#1b2452',\r\n    borderRadius: theme.spacing( 1, 1, 0, 0 ),\r\n    boxShadow:        'black 1px 1px 8px',\r\n  },\r\n  rootLast:{\r\n    width: '100%',\r\n    maxWidth: '600px',\r\n    marginTop: theme.spacing(0),\r\n    borderBottomStyle: 'solid',\r\n    borderBottomColor: 'white',\r\n    borderBottomWidth: theme.spacing(0),\r\n    backgroundColor: '#1b2452',\r\n    borderRadius: theme.spacing( 0, 0, 1, 1 ),\r\n    boxShadow:        'black 1px 1px 8px',\r\n  },\r\n  rootOnly:{\r\n    width: '100%',\r\n    maxWidth: '600px',\r\n    marginTop: theme.spacing(0),\r\n    borderBottomStyle: 'solid',\r\n    borderBottomColor: 'white',\r\n    borderBottomWidth: theme.spacing(0),\r\n    backgroundColor: '#1b2452',\r\n    borderRadius: theme.spacing( 2 ),\r\n    boxShadow:        'black 1px 1px 8px',\r\n  },\r\n  media: {\r\n    height: 140,\r\n  },\r\n  title: {\r\n    color: 'white',\r\n    marginLeft: theme.spacing(2),\r\n  },\r\n  content: {\r\n    color: 'white',\r\n    marginLeft: theme.spacing(7),\r\n    marginBottom: theme.spacing(1),\r\n  },\r\n  contentNoMedia:{\r\n    color:        'white',\r\n    marginLeft:   theme.spacing(7),\r\n    marginBottom: theme.spacing(1),\r\n    fontSize:     '1.3rem',\r\n    textIndent:   '0',\r\n    whiteSpace:   'pre-wrap'\r\n  },\r\n  contentEdit: {\r\n    color:          'white',\r\n    marginBottom:   theme.spacing(1),\r\n    background:     'transparent',\r\n    outline:        'none',\r\n    width:          '100%',\r\n    height:         '70px',\r\n    resize:         'none',\r\n    textDecoration: 'underline',\r\n    boxSizing:      'border-box',\r\n    whiteSpace:     'pre-wrap'\r\n  },\r\n  input:{\r\n    display: 'none'\r\n  },\r\n  displayTitle:{\r\n    display: 'inline-flex'\r\n  },\r\n  displaybtn:{\r\n    textAlign: 'right',\r\n    marginTop: theme.spacing(2),\r\n  },\r\n  imgPost:{\r\n    maxWidth: 450,\r\n  },\r\n  contImg:{\r\n    alignItems: 'center',\r\n    textAlign: 'center',\r\n    marginBottom: theme.spacing(1),\r\n  },\r\n  contMedia:{\r\n    display:        'flex',\r\n    flexDirection:  'column',\r\n    flexWrap:       'wrap'\r\n  },\r\n  date:{\r\n    fontSize: '0.7rem',\r\n    color:    'gray',\r\n    display:  'block'\r\n  },\r\n  avatar:{\r\n    backgroundColor: '#333333',\r\n    border: '1px solid #f28a9a'\r\n  },\r\n  cardBtn: {\r\n    alignItems:     'center',\r\n    justifyContent: 'space-around',\r\n    color:          'white',\r\n  },\r\n  saveIcon:{\r\n    color: '#33eaff',\r\n  },\r\n  mediaIcon:{\r\n    color: '#ea5970'\r\n  },\r\n  deleteBtn:{\r\n    marginRight: theme.spacing(2)\r\n  }\r\n}));\r\n\r\nexport const ReplyCard = ( props ) => {\r\n\r\n  const { reply, first, last }    = props;\r\n  const classes = useStyles();\r\n  const inputFileRef = useRef();\r\n\r\n  const [ state, setState ] = useState({\r\n    editMode:         false,\r\n    content:          reply.content,\r\n    originalContent:  reply.content,\r\n    medias:           reply.medias,\r\n    originalMedias:   reply.medias,\r\n    deleted:          [],\r\n    newMedias:        []\r\n  });\r\n  const [del, setDel] = useState(false);\r\n\r\n  const temp = { state, setState};\r\n\r\n  let cardRootClass;\r\n  if( first && last ){\r\n    cardRootClass = classes.rootOnly;\r\n  }\r\n  else if( first ){\r\n    cardRootClass = classes.rootFirst;\r\n  }\r\n  else if( last ){\r\n    cardRootClass = classes.rootLast;\r\n  }\r\n  else{\r\n    cardRootClass = classes.root;\r\n  }\r\n\r\n  const dateString = new Date( Date.parse( reply.date ) ).toLocaleString();\r\n\r\n  const onClickSave = ()=>{\r\n\r\n    let model = new UReplyModel({\r\n      content: state.content,\r\n      deleted: state.deleted,\r\n      files:   state.newMedias });\r\n\r\n    updateReply( reply.replyID, model)\r\n      .then( handleResponse )\r\n      .then( res => {\r\n        let { data } = res;\r\n\r\n        setState(x=>{\r\n          let copy              = {...x};\r\n          copy.editMode         = false;\r\n          copy.originalContent  = data.content;\r\n          copy.medias           = data.medias;\r\n          copy.originalMedias   = data.medias;\r\n          return copy;\r\n        });\r\n      })\r\n      .catch(console.warn);\r\n  };\r\n\r\n  const onChangeContent = e=>{\r\n    setState( x =>{\r\n      let copy = {...x};\r\n      copy.content = e.target.value;\r\n      return copy;\r\n    });\r\n  };\r\n\r\n  const onChangeImages = async e=>{\r\n    let {files} = e.target;\r\n\r\n    if( state.medias.length + files.length > 4 )\r\n      return;\r\n\r\n    const mediaInfo    = [];\r\n    const newMediaFiles = [];\r\n    for ( let i = 0; i < files.length; i++ ){\r\n      let file = files[i];\r\n      let preview = await fileToBase64( file );\r\n      \r\n      const mediaViewModel = {\r\n        mediaID:  null,\r\n        mime:     file.type,\r\n        path:     preview,\r\n        isVideo:  file.type.includes('video')\r\n      };\r\n\r\n      mediaInfo     .push( mediaViewModel );\r\n      newMediaFiles .push( file );\r\n    }\r\n\r\n    setState( x=>{\r\n      let copy = {...x};\r\n      copy.medias = [...copy.medias, ...mediaInfo];\r\n      copy.newMedias = [...copy.newMedias, ...newMediaFiles];\r\n      return copy;\r\n    });\r\n  };\r\n\r\n  const onClickFileOpen = ()=>inputFileRef.current?.click();\r\n\r\n  const onToggleEditMode = ()=>{\r\n    setState( x =>{\r\n      let copy = {...x};\r\n      copy.editMode = !copy.editMode;\r\n\r\n      if( copy.editMode === false ){\r\n        copy.medias     = [...copy.originalMedias];\r\n        copy.content    = copy.originalContent;\r\n        copy.deleted    = [];\r\n        copy.newMedias  = [];\r\n      }\r\n      return copy;\r\n    })\r\n  };\r\n\r\n  const onClickDelete = ()=>{\r\n    if(window.confirm('Seguro que quiere borrar la respuesta')){\r\n      deleteReply(reply.replyID)\r\n      .then(handleResponse)\r\n      .then( res =>{\r\n        setDel( true );\r\n      })\r\n      .catch(console.warn);\r\n    }\r\n  };\r\n\r\n  if( del ){\r\n    return <></>\r\n  }\r\n\r\n  return (\r\n    <Card className={cardRootClass}>\r\n        <CardContent>\r\n\r\n          <div className={classes.displayTitle}>\r\n            <Link to={routes.getProfile(reply.publisherID)}>\r\n              <Avatar className={classes.avatar} src={reply.publisherProfilePic}/>\r\n            </Link>\r\n\r\n            <Link to={routes.getProfile(reply.publisherID)}>\r\n              <Typography variant='h6' component='h2' className={classes.title}>\r\n                <strong>{reply.publisherUserName} {'@'+reply.publisherTag}</strong>\r\n              </Typography>\r\n            </Link>\r\n            \r\n\r\n          </div>\r\n          <p className={classes.date}>{ dateString.slice( 0, dateString.length - 6 ) } { dateString.slice(dateString.length-3) }</p>\r\n\r\n          {\r\n            state.editMode ? \r\n            (<textarea className={classes.contentEdit} value={state.content} onChange={onChangeContent}></textarea>)\r\n            :\r\n            (<Typography variant='body2' component='p' className={state.medias.length !== 0 ? classes.content : classes.contentNoMedia} >{state.originalContent}</Typography>)\r\n          }\r\n          \r\n          {\r\n            state.editMode &&\r\n            <>\r\n            <input accept='image/*' className={classes.input} type='file' multiple ref={inputFileRef} onChange={onChangeImages}/>\r\n              <IconButton onClick={onClickFileOpen}>\r\n                <ImageIcon className={classes.mediaIcon}/>\r\n              </IconButton>\r\n            </>\r\n          }\r\n\r\n          <div className={classes.contMedia}>\r\n            <MediaGrid media={ state.medias } {...temp}/>\r\n          </div>\r\n          \r\n          <div  className={classes.displaybtn}>\r\n          {\r\n            (authenticationService.currentUserValue.id === reply.publisherID)\r\n            && \r\n            <>\r\n              <Button \r\n                variant='contained' \r\n                color='secondary' \r\n                onClick={onClickDelete}\r\n                className={classes.deleteBtn}\r\n              >\r\n                  Eliminar\r\n              </Button>\r\n              <Button \r\n                variant='contained' \r\n                color='secondary' \r\n                onClick={onToggleEditMode}\r\n              >\r\n                { state.editMode ? 'Cancelar' : 'Editar' }\r\n              </Button>\r\n            </>\r\n          }\r\n          </div>\r\n        </CardContent>\r\n\r\n        <CardActions disableSpacing className={classes.cardBtn}>\r\n          {\r\n            (authenticationService.currentUserValue.id === reply.publisherID && state.editMode)\r\n            && \r\n            <div>\r\n              <IconButton onClick   = { onClickSave }>\r\n                <SaveIcon className = { classes.saveIcon}/>\r\n              </IconButton>\r\n            </div>\r\n          }\r\n        </CardActions>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default ReplyCard;"]},"metadata":{},"sourceType":"module"}